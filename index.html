<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mapa de Alex√¢nia - OSM</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        #map {
            height: 100vh;
            width: 100%;
        }
        .circle-number {
            background-color: gray;
            color: white;
            border-radius: 50%;
            text-align: center;
            line-height: 40px;  /* Para centralizar o n√∫mero */
            width: 40px;
            height: 40px;
            font-size: 16px;
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/appwrite@13.0.0"></script>

</head>
<body>
    <div id="map"></div>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        var map = L.map('map').setView([-16.0833, -48.5000], 15);
        
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; OpenStreetMap contributors'
        }).addTo(map);
        
        var quadras = [
            { lat: -16.074919, lng: -48.499585, id: 212 },
            { lat: -16.073372, lng: -48.501120, id: 229},
            { lat:-16.074032, lng: -48.501109, id: 222},
            { lat:-16.074723, lng: -48.501248, id: 213},
            { lat:-16.075352, lng: -48.501323, id: 204},
            { lat:-16.076032, lng: -48.501366, id: 196},
            { lat:-16.076744, lng: -48.501388, id: 188},
            { lat:-16.077403, lng: -48.501484, id: 182},
            { lat:-16.078073, lng: -48.501602, id: 166},
            { lat: -16.073280, lng: -48.502536, id: 230},
            { lat: -16.073852, lng: -48.502632, id: 223},
            { lat: -16.074563, lng: -48.502707, id: 214},
            { lat: -16.075228, lng: -48.502766, id: 205},
            { lat: -16.075919, lng: -48.502836, id: 197},
            { lat: -16.076579, lng: -48.503003, id: 189},
            { lat: -16.077254, lng: -48.502981, id: 183},
            { lat: -16.077970, lng: -48.503067, id: 167},
            { lat: -16.073073, lng: -48.504038, id: 231},
            { lat: -16.073754, lng: -48.504113, id: 224},
            { lat: -16.074424, lng: -48.504145, id: 215},
            { lat: -16.075084, lng: -48.504242, id: 206},
            { lat: -16.075692, lng: -48.504360, id: 199},
            { lat: -16.076465, lng: -48.504403, id: 190},
            { lat: -16.077053, lng: -48.504553, id: 184},
            { lat: -16.077754, lng: -48.504564, id: 168},
            { lat: -16.072950, lng: -48.505218, id: 4},
            { lat: -16.073610, lng: -48.505266, id: 3},
            { lat: -16.074249, lng: -48.505706, id: 2},
            { lat: -16.074883, lng: -48.505797, id: 207},
            { lat: -16.075553, lng: -48.505883, id: 199},
            { lat: -16.076228, lng: -48.505931, id: 191},
            { lat: -16.076888, lng: -48.506087, id: 185},
            { lat: -16.077548, lng: -48.506146, id: 169}
        ];
        
        quadras.forEach(function(location) {
            var circle = L.circle([location.lat, location.lng], {
                color: 'gray',
                fillColor: 'gray',
                fillOpacity: 0.6,
                radius: 20
            }).addTo(map);
            
            // Criar o marcador para o n√∫mero ao lado do c√≠rculo
            var numberIcon = L.divIcon({
                className: 'circle-number',
                html: location.id,  // Exibe o n√∫mero ao lado do c√≠rculo
                iconSize: [40, 40],
                iconAnchor: [20, 20],  // Posi√ß√£o do c√≠rculo
                popupAnchor: [50, 0]  // Posi√ß√£o do n√∫mero √† direita do c√≠rculo
            });
            
            var marker = L.marker([location.lat, location.lng], { icon: numberIcon }).addTo(map);
            
            // Fun√ß√£o para mudar a cor do c√≠rculo e do n√∫mero
            function changeColor() {
                var currentColor = circle.options.fillColor;
                var newColor = currentColor === 'gray' ? 'green' : 'gray';
                
                // Muda a cor do c√≠rculo
                circle.setStyle({
                    fillColor: newColor,
                    color: newColor
                });

                // Muda a cor do marcador (n√∫mero)
                marker._icon.style.backgroundColor = newColor;
            }

            // Evento de clique no c√≠rculo
            circle.on('click', function() {
                changeColor();
            });

            // Evento de clique no n√∫mero
            marker.on('click', function() {
                changeColor();
            });
        });
    </script>

<script src="https://cdn.jsdelivr.net/npm/appwrite@latest"></script>
<script>
    const { Client, Databases, ID, Query } = Appwrite;

const client = new Client()
    client
    .setEndpoint('https://cloud.appwrite.io/v1') // URL do Appwrite
    .setProject('67a184f0003d528ef9ae'); // Substitua pelo seu ID do projeto

const database = new Databases(client);

console.log(client);
console.log(database);

async function fetchData() {
  try {
    const response = await databases.listDocuments("DATABASE_ID", "COLLECTION_ID");
    console.log("Dados recebidos:", response);
  } catch (error) {
    console.error("Erro ao buscar dados:", error);
  }
}

fetchData();


</script>
<script>
async function salvarStatusQuadra(quadra, status) {
    console.log("üîµ Tentando salvar status...");
    console.log("üìç Quadra:", quadra, "üü¢ Novo Status:", status);

    try {
        // Verifica se j√° existe um documento para essa quadra
        const res = await database.listDocuments('67a18532002b5c1c9e36', '67a1853b00111b8799ea', [
            Query.equal("quadra", quadra)
        ]);

        console.log("üìÑ Documentos encontrados:", res.documents.length);

        if (res.documents.length > 0) {
            console.log("üü° Atualizando documento existente:", res.documents[0].$id);
            await database.updateDocument('67a18532002b5c1c9e36', '67a1853b00111b8799ea', res.documents[0].$id, { status });
            console.log("‚úÖ Status atualizado com sucesso!");
        } else {
            console.log("üÜï Criando novo documento...");
            await database.createDocument('67a18532002b5c1c9e36', '67a1853b00111b8799ea', ID.unique(), { quadra, status });
            console.log("‚úÖ Novo status salvo com sucesso!");
        }
    } catch (error) {
        console.error("‚ùå Erro ao salvar status:", error);
    }
}


</script>
<script>
async function carregarStatusQuadras() {
    try {
        const records = await database.listDocuments('67a18532002b5c1c9e36', '67a1853b00111b8799ea');
        records.documents.forEach(record => {
            atualizarCorQuadra(record.quadra, record.status);
        });
    } catch (error) {
        console.error("Erro ao carregar dados:", error);
    }
}

</script>

</body>
</html>
